<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="web.shoppingmall.mapper.CustomerMapper">
	<resultMap type="web.shoppingmall.domain.CustomerVO" id="customerMap">
		<id property="customerId" column="customer_id"/>
		<result property="customerId" column="customer_id"/>
		<result property="customerPw" column="customer_pw"/>
		<result property="customerName" column="customer_name"/>
		<result property="customerPhone" column="customer_phone"/>
		<result property="customerState" column="customer_state"/>
		<result property="regDate" column="reg_date"/>
		<result property="updateDate" column="update_date"/>
		<result property="auth" column="auth"/>
		<result property="businessNo" column="business_number"/>
		<collection property="addrList" resultMap="addrMap"></collection>
	</resultMap>
	<resultMap type="web.shoppingmall.domain.AddressDTO" id="addrMap">
		<result property="addrNo" column="addr_num"/>
		<result property="mainAddr" column="addr_main"/>
		<result property="detailAddr" column="addr_detail"/>
		<result property="zipNo" column="addr_zipno"/>
		<result property="customerId" column="customer_id"/>
		<result property="regDate" column="addr_reg_date"/>
		<result property="updateDate" column="addr_update_date"/>
	</resultMap>
	
	<insert id="customerRegister">
		INSERT INTO customer (
		    customer_id,
		    customer_pw,
		    customer_name,
		    customer_phone,
		    auth,
		    business_number
		) VALUES (
		    #{customerId},
		    #{customerPw},
		    #{customerName},
		    #{customerPhone},
		    #{auth},
		    #{businessNo}
		)
	</insert>
	<select id="customerInformation" resultMap="customerMap">
		<![CDATA[
			SELECT
			    c.customer_id,
			    c.customer_pw,
			    c.customer_name,
			    c.customer_phone,
			    c.customer_state,
			    c.reg_date,
			    c.update_date,
			    c.auth,
			    c.business_number,
			    addr.addr_num,
			    addr.addr_main,
			    addr.addr_detail,
			    addr.addr_zipno,
			    addr.customer_id,
			    addr.reg_date as addr_reg_date,
			    addr.update_date as addr_update_date
			FROM
			    customer c
			    LEFT OUTER JOIN address addr 
			    ON c.customer_id = addr.customer_id
			WHERE
			    c.customer_id = #{customerId}
			ORDER BY
    			addr_num ASC
		]]>
	</select>
	<update id="customerCorrection">
		UPDATE customer
		SET
		    customer_pw = #{customerPw},
		    customer_name= #{customerName},
		    customer_phone= #{customerPhone},
		    update_date = sysdate,
		    auth = #{auth}
		WHERE
		    customer_id = #{customerId}
	</update>
	<delete id="customerDelete">
		delete from customer where customer_id = #{customerId}
	</delete>
</mapper>